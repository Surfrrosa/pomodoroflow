# PomodoroFlow v1.1 - Premium Features Reintegration Plan

**Status:** REMOVED FOR v1.0 APP STORE APPROVAL
**Reintegration Timeline:** After v1.0 approval and initial user feedback
**Last Updated:** October 6, 2025

---

## Why Features Were Removed

During Apple App Store submission review, the app was rejected due to:
- **Session limiting** (5 sessions/day for free users) combined with **non-functional IAP** created a broken user experience
- Apple Guideline 2.1 violation: Core functionality artificially restricted with broken payment system
- Revenue Cat integration was incomplete (placeholder API key)

**Decision:** Remove ALL premium features for v1.0 to ensure quick approval and get app to market. Reintegrate in v1.1 with fully functional IAP.

---

## Features to Reintegrate in v1.1

### 1. **Freemium Model with Session Limiting**

**Behavior:**
- Free users: 5 Pomodoro sessions per day
- Daily counter resets at midnight (local time)
- Premium users: Unlimited sessions
- When limit reached: Show upgrade modal (NOT blocking, user can dismiss)

**User Experience:**
- Session counter displayed below timer: "Free: 3/5 sessions today"
- Premium badge displayed: "✨ Premium User"
- Graceful degradation: If IAP fails, don't block users

**Implementation Files:**
- `App.js` lines 35-38 (state variables)
- `App.js` lines 108-130 (loadPremiumStatus function)
- `App.js` lines 234-237 (onStart function - session limiting)
- `App.js` lines 299-307 (Premium status display UI)

**AsyncStorage Keys:**
```javascript
'@pomodoroflow:is_premium'        // 'true' | 'false'
'@pomodoroflow:daily_sessions'    // integer count
'@pomodoroflow:last_session_date' // date string for reset logic
```

---

### 2. **Premium Upgrade Modal**

**Behavior:**
- Triggered when free user hits 5-session limit
- Beautiful dark-themed modal matching app design
- Shows premium benefits
- One-time purchase: $4.99
- "Restore Purchases" button (REQUIRED by Apple Guideline 3.1.1)
- "Maybe Later" button to dismiss

**UI Components:**
- Modal with overlay backdrop
- Feature list with checkmarks
- Price display ($4.99)
- Two action buttons: "Upgrade to Premium" and "Maybe Later"

**Implementation Files:**
- `App.js` lines 308-351 (Modal JSX)
- `App.js` lines 368-391 (Modal styles)
- Line 380: Replace Alert.alert with actual purchase function

**Current Design (KEEP THIS EXACT UI):**
```jsx
<Modal visible={showUpgrade} transparent animationType="fade">
  <View style={styles.overlay}>
    <View style={styles.modal}>
      <Text style={styles.title}>Daily Limit Reached</Text>
      <Text style={styles.message}>You've used {dailySessions} of 5 free sessions today.</Text>

      <View style={styles.features}>
        <Text style={styles.featuresTitle}>Premium includes:</Text>
        <Text style={styles.feature}>✓ Unlimited daily sessions</Text>
        <Text style={styles.feature}>✓ Custom timer durations</Text>
        <Text style={styles.feature}>✓ Session history & analytics</Text>
        <Text style={styles.feature}>✓ Premium sounds & themes</Text>
      </View>

      <View style={styles.pricing}>
        <Text style={styles.price}>$4.99</Text>
        <Text style={styles.priceSubtext}>One-time purchase • No subscriptions</Text>
      </View>

      <Pressable style={styles.purchaseButton} onPress={handlePurchase}>
        <Text style={styles.purchaseButtonText}>Upgrade to Premium</Text>
      </Pressable>

      <Pressable style={styles.closeButton} onPress={() => setShowUpgrade(false)}>
        <Text style={styles.closeButtonText}>Maybe Later</Text>
      </Pressable>
    </View>
  </View>
</Modal>
```

**IMPORTANT:** Keep the same visual design, colors, spacing, and animation. Only replace the purchase logic.

---

### 3. **Revenue Cat Integration**

**Setup Required:**
1. Create Revenue Cat account at https://www.revenuecat.com/
2. Configure iOS and Android apps in Revenue Cat dashboard
3. Create product ID: `pomodoroflow_premium` (one-time purchase, $4.99)
4. Get API keys for iOS and Android
5. Install package: `npm install react-native-purchases`
6. Configure entitlements in Revenue Cat (e.g., "premium_access")

**Implementation Files:**
- `lib/purchases.ts` (ALREADY WRITTEN, needs API key)
- `components/PremiumProvider.tsx` (ALREADY WRITTEN, ready to use)
- `components/UpgradePrompt.tsx` (needs minor tweaks to match modal)

**Revenue Cat Configuration:**
```typescript
// lib/purchases.ts line 39
await Purchases.configure({
  apiKey: 'YOUR_ACTUAL_REVENUECAT_API_KEY', // REPLACE THIS
  appUserID: userId,
});
```

**Product IDs:**
- iOS: `com.surfrrosa.pomodoroflow.premium`
- Android: `com.surfrrosa.pomodoroflow.premium`

**Entitlement ID:** `premium_access`

---

### 4. **In-App Purchase Flow**

**Purchase Function:**
```typescript
const handlePurchase = async () => {
  try {
    setShowUpgrade(false);

    // Show loading state
    Alert.alert("Processing", "Connecting to App Store...");

    // Attempt purchase
    const purchaseResult = await Purchases.purchaseProduct('pomodoroflow_premium');

    // Check entitlement
    const customerInfo = await Purchases.getCustomerInfo();
    const isPremium = customerInfo.entitlements.active['premium_access'] !== undefined;

    if (isPremium) {
      await AsyncStorage.setItem('@pomodoroflow:is_premium', 'true');
      setIsPremium(true);
      Alert.alert("Success!", "You're now a premium user. Enjoy unlimited sessions!");
    }
  } catch (error) {
    if (error.userCancelled) {
      // User cancelled - don't show error
      return;
    }
    Alert.alert("Purchase Failed", "Please try again or contact support.");
    console.error("Purchase error:", error);
  }
};
```

**Restore Purchases Function (REQUIRED by Apple):**
```typescript
const handleRestorePurchases = async () => {
  try {
    Alert.alert("Restoring", "Checking for previous purchases...");

    const customerInfo = await Purchases.restorePurchases();
    const isPremium = customerInfo.entitlements.active['premium_access'] !== undefined;

    if (isPremium) {
      await AsyncStorage.setItem('@pomodoroflow:is_premium', 'true');
      setIsPremium(true);
      Alert.alert("Success!", "Your premium access has been restored.");
    } else {
      Alert.alert("No Purchases Found", "We couldn't find any previous purchases for this account.");
    }
  } catch (error) {
    Alert.alert("Restore Failed", "Please try again or contact support.");
    console.error("Restore error:", error);
  }
};
```

**Add Restore Button to Modal:**
```jsx
<Pressable style={styles.restoreButton} onPress={handleRestorePurchases}>
  <Text style={styles.restoreButtonText}>Restore Purchases</Text>
</Pressable>
```

---

### 5. **App Store Configuration**

**iOS App Store Connect:**
1. Go to "App Information" → "In-App Purchases"
2. Create new in-app purchase:
   - Type: Non-Consumable
   - Reference Name: "PomodoroFlow Premium"
   - Product ID: `com.surfrrosa.pomodoroflow.premium`
   - Price: $4.99 (Tier 5)
3. Add localized descriptions and screenshots
4. Submit for review WITH the app update

**Google Play Console:**
1. Go to "Monetize" → "In-app products"
2. Create managed product:
   - Product ID: `com.surfrrosa.pomodoroflow.premium`
   - Name: "PomodoroFlow Premium"
   - Description: "Unlock unlimited Pomodoro sessions and premium features"
   - Price: $4.99
3. Activate the product

---

### 6. **Future Premium Features** (Beyond v1.1)

Listed in the modal but NOT implemented yet. Add in future versions:

**v1.2+:**
- ✓ Custom timer durations (allow user to change 25/5 defaults)
- ✓ Session history & analytics (track completed sessions, visualize productivity)
- ✓ Premium sounds & themes (multiple chime sounds, color themes)
- ✓ Long break support (every 4 Pomodoros = 15-minute break)
- ✓ Focus goals and streak tracking
- ✓ iCloud sync across devices

**Implementation Note:** These features are aspirational for marketing purposes. Implement gradually after v1.1 launch.

---

## Reintegration Checklist for v1.1

### Pre-Implementation
- [ ] Get approval for v1.0 (free, unlimited app)
- [ ] Monitor v1.0 user feedback for 2-4 weeks
- [ ] Create Revenue Cat account
- [ ] Configure products in App Store Connect and Google Play
- [ ] Get Revenue Cat API keys

### Code Changes
- [ ] Install `react-native-purchases` package
- [ ] Uncomment premium state variables in App.js (lines 35-38)
- [ ] Uncomment loadPremiumStatus function (lines 108-130)
- [ ] Restore session limiting in onStart (lines 234-237)
- [ ] Restore premium status display UI (lines 299-307)
- [ ] Restore upgrade modal (lines 308-351)
- [ ] Replace Alert.alert with actual purchase function (line 380)
- [ ] Add handlePurchase and handleRestorePurchases functions
- [ ] Add "Restore Purchases" button to modal
- [ ] Update lib/purchases.ts with real API key
- [ ] Integrate PremiumProvider.tsx context
- [ ] Test purchase flow on TestFlight (iOS) and Internal Testing (Android)

### Testing
- [ ] Test free user experience (5 session limit)
- [ ] Test upgrade flow (sandbox environment)
- [ ] Test restore purchases on new device
- [ ] Test premium user experience (unlimited sessions)
- [ ] Test daily session reset at midnight
- [ ] Test graceful degradation if IAP fails
- [ ] Test on iOS and Android

### App Store Submission
- [ ] Update version to 1.1.0
- [ ] Add IAP to "What's New" description
- [ ] Submit in-app purchase products for review
- [ ] Submit app update for review
- [ ] Monitor for rejection issues

---

## Important Notes

### Apple Review Guidelines
- **3.1.1:** Must use Apple's IAP system (no external payment links)
- **3.1.1(a):** Must provide "Restore Purchases" button
- **5.1.1:** Privacy policy must mention purchase data collection

### Design Consistency
- **KEEP THE SAME UI/UX** as removed in v1.0
- Same modal design, colors (#4CAF50 for premium green, #1a1a1a for modal background)
- Same tagline: "Radical simplicity — 25/5 on loop."
- Same session counter format: "Free: X/5 sessions today"

### Error Handling
- Don't block users if IAP system fails
- Always allow dismissing the upgrade modal
- Provide clear error messages for purchase failures
- Log errors to monitoring service (add Sentry in v1.1)

### Analytics (Add in v1.1)
- Track upgrade modal views
- Track purchase attempts vs completions
- Track session usage patterns (free vs premium)
- Track restore purchase usage

---

## Code References

**Files to Restore (Currently Commented Out):**
- `App.js` - Main premium logic
- `lib/purchases.ts` - Revenue Cat integration (complete, needs API key)
- `components/PremiumProvider.tsx` - Premium context provider (complete)
- `components/UpgradePrompt.tsx` - Alternative modal implementation

**Files to Delete (Unused in v1.0):**
- These files are READY for v1.1, don't delete them
- Keep in repo for future reintegration

**Search Keywords for Code:**
```bash
# Find all commented-out premium code
grep -r "Premium features removed for v1.0" .

# Find AsyncStorage keys
grep -r "@pomodoroflow:is_premium" .
grep -r "@pomodoroflow:daily_sessions" .
```

---

## Revenue Projections (Estimate)

**Conservative Estimates:**
- v1.0 downloads in first month: 500-1000 users
- Conversion rate to premium: 2-5%
- Premium sales in month 1: 10-50 purchases
- Revenue in month 1: $50-250

**With Marketing Push:**
- Monthly downloads: 5000+ users
- Conversion rate: 5-10%
- Monthly premium sales: 250-500 purchases
- Monthly revenue: $1,250-2,500

**Note:** Don't implement IAP until v1.0 proves product-market fit.

---

## Contact & Support

**Developer:** Shaina Pauley (shainaep)
**Bundle ID:** com.surfrrosa.pomodoroflow
**Support Email:** [Add support email for IAP issues]
**Privacy Policy:** [Create and host before v1.1 launch]

---

## Version History

- **v1.0.0:** Initial launch, free unlimited sessions, no IAP
- **v1.1.0:** (Planned) Reintegrate premium features with functional IAP
- **v1.2.0:** (Future) Add custom timer durations
- **v2.0.0:** (Future) Session history, analytics, and themes
